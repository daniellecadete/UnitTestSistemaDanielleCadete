node {
    stage('Build') {
      node() {
        echo 'Master...'
        try {
			  sh "sudo chown -R jenkins: ${WORKSPACE}"
			  deleteDir()			  
			  checkout scm
			  sh "sudo printenv > resultado"
			 }
			catch (e) {
			  status = 'F'
			  echo 'Falhou.'
			  throw e
			}
			finally {
		      if (status=='S'){ 
			    sh 'echo "Master construído!"  >> resultado'
				stash includes: '**/resultado', name: 'res'
			   }
		      else{
		        sh 'echo "Construção finalizada com erro!" >> resultado'
				archiveArtifacts artifacts: '**/resultado', fingerprint: true
			 }        
      }
     }  
      
    stage("Test") {
      node('slave') {
        echo 'Slave'
        sh 'hostname'
        
        unstash 'app'
        sh 'cat result'
        archiveArtifacts artifacts: '**/result', fingerprint: true
        //sh "sudo docker run -v /home/dani/devops/exercicio3/srv/jenkins/workspace/${JOB_NAME}:/workspace -w /workspace maven:latest mvn install"
      }
    }     
}
